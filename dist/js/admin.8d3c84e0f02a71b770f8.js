!function(){"use strict";var e={showMessage:function(e,t){var n=document.createElement("div");n.className="message message-"+(t||"info"),n.textContent=e,document.body.appendChild(n),setTimeout((function(){n.remove()}),3e3)},formatDate:function(e){return new Date(e).toLocaleString()},debounce:function(e,t){var n;return function(){var a=arguments,o=this;clearTimeout(n),n=setTimeout((function(){n=null,e.apply(o,a)}),t)}}};function t(){var e=window.location.pathname;document.querySelectorAll(".admin-menu a").forEach((function(t){var n=t.getAttribute("href");if(e.endsWith(n)){t.classList.add("active");var a=t.closest("li.has-submenu");a&&a.classList.add("expanded")}}))}function n(t){var n=document.querySelector(".admin-content-inner");n&&(e&&e.showLoading&&e.showLoading(),fetch("pages/"+t+".html").then((function(e){if(!e.ok)throw new Error("页面加载失败");return e.text()})).then((function(a){n.innerHTML=a,function(e){switch(console.log("初始化页面脚本:",e),e){case"dashboard":initDashboard();break;case"articles":initArticles();break;case"users":initUsers();break;case"settings":initSettings()}}(t),e&&e.hideLoading&&e.hideLoading()})).catch((function(t){n.innerHTML='<div class="error-message">加载页面时出错: '+t.message+"</div>",e&&e.hideLoading&&e.hideLoading(),e&&e.showMessage&&e.showMessage("页面加载失败: "+t.message,"error")})))}document.addEventListener("DOMContentLoaded",(function(){var e,a,o,i,s,c;console.log("管理后台已加载"),s=document.querySelector(".admin-sidebar"),(c=document.querySelector(".sidebar-toggle"))&&s&&c.addEventListener("click",(function(){s.classList.toggle("collapsed"),document.querySelector(".admin-content").classList.toggle("expanded")})),t(),document.querySelectorAll(".admin-menu a[data-target]").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-target");n(t),history.pushState({page:t},"",this.getAttribute("href")),document.querySelectorAll(".admin-menu a").forEach((function(e){e.classList.remove("active")})),this.classList.add("active")}))})),window.addEventListener("popstate",(function(e){e.state&&e.state.page&&(n(e.state.page),t())})),o=document.querySelector(".user-menu-toggle"),i=document.querySelector(".user-dropdown"),o&&i&&(o.addEventListener("click",(function(e){e.preventDefault(),i.classList.toggle("active")})),document.addEventListener("click",(function(e){o.contains(e.target)||i.contains(e.target)||i.classList.remove("active")}))),e=document.getElementById("dark-mode-toggle"),(a=localStorage.getItem("admin-theme"))?(document.body.classList.add(a),"dark-mode"===a&&(e.checked=!0)):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.body.classList.add("dark-mode"),e.checked=!0),e&&e.addEventListener("change",(function(){this.checked?(document.body.classList.remove("light-mode"),document.body.classList.add("dark-mode"),localStorage.setItem("admin-theme","dark-mode")):(document.body.classList.remove("dark-mode"),document.body.classList.add("light-mode"),localStorage.setItem("admin-theme","light-mode"))}))}))}();