class UnifiedThemeManager{constructor(){this.themeKey="moonlight_theme",this.themes=["light","dark","auto"],this.currentTheme="auto",this.init()}init(){const e=localStorage.getItem(this.themeKey)||"auto";this.currentTheme=e,this.applyTheme(e),this.bindToggleButtons(),this.watchSystemTheme()}getSystemTheme(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}getActualTheme(e){return"auto"===e?this.getSystemTheme():e}applyTheme(e){const t=this.getActualTheme(e),a=document.documentElement,h=document.body;a.classList.remove("theme-light","theme-dark"),h.classList.remove("theme-light","theme-dark"),a.removeAttribute("data-theme"),a.classList.add(`theme-${t}`),h.classList.add(`theme-${t}`),a.setAttribute("data-theme",t),this.updateToggleIcons(e),localStorage.setItem(this.themeKey,e),this.currentTheme=e,this.dispatchThemeEvent(t,e)}updateToggleIcons(e){document.querySelectorAll(".theme-toggle, #theme-toggle-btn, [data-theme-toggle]").forEach((t=>{const a=t.querySelector("i")||t;"auto"===e?("I"===a.tagName&&(a.className="fas fa-adjust"),t.title="跟随系统主题"):"dark"===e?("I"===a.tagName&&(a.className="fas fa-sun"),t.title="切换到亮色模式"):("I"===a.tagName&&(a.className="fas fa-moon"),t.title="切换到暗色模式")}))}bindToggleButtons(){const e=document.querySelectorAll(".theme-toggle, #theme-toggle-btn, [data-theme-toggle]");e.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),this.toggleTheme()}))})),e.length}toggleTheme(){let e;switch(this.currentTheme){case"auto":e="light";break;case"light":e="dark";break;default:e="auto"}this.applyTheme(e)}watchSystemTheme(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{"auto"===this.currentTheme&&this.applyTheme("auto")}))}dispatchThemeEvent(e,t){const a=new CustomEvent("themechange",{detail:{theme:e,preference:t,timestamp:Date.now()}});window.dispatchEvent(a)}setTheme(e){this.themes.includes(e)&&this.applyTheme(e)}getCurrentTheme(){return{preference:this.currentTheme,actual:this.getActualTheme(this.currentTheme)}}}document.addEventListener("DOMContentLoaded",(function(){window.unifiedThemeManager||(window.unifiedThemeManager=new UnifiedThemeManager,window.themeSwitcher=window.unifiedThemeManager,window.themeManager=window.unifiedThemeManager)}));