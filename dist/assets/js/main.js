var pageSize=6,currentPage=1,totalPages=1,allArticles=[],currentTag=null,searchQuery="",isSearching=!1,articles=[{title:"Moonlight助手",excerpt:"基于人工智能的智能对话助手，为博客访客提供即时帮助和信息查询服务。",image:"/assets/images/articles/chatbot.jpg",url:"#"},{title:"Moonlight博客",excerpt:"一个梦幻朦胧之美的个人博客空间，记录技术探索和创意思考的点点滴滴。",image:"/assets/images/articles/blog.jpg",url:"#"}],ARTICLES_PER_PAGE=6;function loadProfileInfo(){try{var e=document.getElementById("profile-info");if(!e)return void console.log("未找到profile-info元素，跳过加载个人信息");var t={name:"博主名字",bio:"热爱技术和创新，专注于绘画、文字排版，人工智能、云计算和大数据领域的研究与应用。",focus:"AI, 云计算, 大数据",email:"example@moonlight-blog.com"},n=`\n            <h3>${t.name}</h3>\n            <p>${t.bio}</p>\n            <div class="profile-details">\n                <p><strong>专注领域：</strong> ${t.focus}</p>\n                <p><strong>联系邮箱：</strong> ${t.email}</p>\n            </div>\n        `;e.innerHTML=n}catch(e){console.error("加载个人信息时出错:",e),document.getElementById("profile-info")&&(document.getElementById("profile-info").innerHTML="\n                <p>加载个人信息时出错。请稍后再试。</p>\n            ")}}function loadArticles(){const e=getQueryParam("tag");e&&(currentTag=e),fetch("articles/index.json").then((e=>e.json())).then((e=>{Array.isArray(e)&&e.length>0?(allArticles=e.map((e=>({...e,image:e.cover||"/assets/images/default-cover.jpg",url:`article.html?file=${encodeURIComponent(e.file)}`}))),totalPages=Math.ceil(allArticles.length/pageSize)):(allArticles=articles,totalPages=Math.ceil(allArticles.length/pageSize)),"function"==typeof updatePageIndicator&&updatePageIndicator(),renderTagFilter(),renderArticles(),"function"==typeof updatePaginationButtons&&updatePaginationButtons()})).catch((e=>{console.error("加载文章索引失败，使用静态数据",e),allArticles=articles,totalPages=Math.ceil(allArticles.length/pageSize),"function"==typeof updatePageIndicator&&updatePageIndicator(),renderTagFilter(),renderArticles(),"function"==typeof updatePaginationButtons&&updatePaginationButtons()}))}function renderArticles(){var e=document.getElementById("articles-container");if(e){e.innerHTML="";var t=currentTag?allArticles.filter((e=>Array.isArray(e.tags)&&e.tags.includes(currentTag))):allArticles;t=searchArticles(t,searchQuery);var n=(currentPage-1)*pageSize,r=Math.min(n+pageSize,t.length),a=t.slice(n,r);if(0!==a.length)for(var i=0;i<a.length;i++){var c=a[i],l=document.createElement("div");l.className="article-card glass-panel",c.top&&l.classList.add("article-top");var o=c.date||c.publishDate,s=(o?new Date(o):new Date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"});const t=highlightSearchResult(c.title,searchQuery),n=highlightSearchResult(c.excerpt||c.summary||"",searchQuery);var d="";Array.isArray(c.tags)&&c.tags.length>0&&(d='<div class="article-tags">'+c.tags.map((e=>`<span class="tag">${e}</span>`)).join("")+"</div>");var u=c.top?'<span class="top-badge">置顶</span>':"",g=c.author?`<span class="article-author"><i class="fas fa-user"></i> ${c.author}</span>`:"";l.innerHTML=`\n            <div class="article-image">\n                <img src="${c.image||"/assets/images/default-cover.jpg"}" alt="${c.title}">\n                ${u}\n            </div>\n            <div class="article-content">\n                <h3>${t}</h3>\n                <p>${n}</p>\n                ${d}\n                <div class="article-meta">\n                    <span>${s}</span>\n                    ${g}\n                </div>\n            </div>\n        `,function(e){l.addEventListener("click",(function(){window.location.href=e||"#"}))}(c.url),e.appendChild(l)}else{const t=searchQuery?`没有找到包含"${searchQuery}"的文章`:"没有找到文章";e.innerHTML=`\n            <div class="empty-message">\n                <p>${t}</p>\n            </div>\n        `}}else console.error("未找到articles-container元素")}function setupPagination(){var e=document.getElementById("prev-page"),t=document.getElementById("next-page");e&&t?(e.onclick=function(){if(currentPage>1){currentPage--,renderArticles(),updatePageIndicator(),updatePaginationButtons();var e=document.getElementById("articles");e&&window.scrollTo({top:e.offsetTop-100,behavior:"smooth"})}},t.onclick=function(){if(currentPage<totalPages){currentPage++,renderArticles(),updatePageIndicator(),updatePaginationButtons();var e=document.getElementById("articles");e&&window.scrollTo({top:e.offsetTop-100,behavior:"smooth"})}}):console.error("分页按钮未找到")}function updatePageIndicator(){var e=document.getElementById("page-indicator");e&&(e.textContent=currentPage+" / "+totalPages)}function updatePaginationButtons(){var e=document.getElementById("prev-page"),t=document.getElementById("next-page");e&&(e.disabled=currentPage<=1),t&&(t.disabled=currentPage>=totalPages)}function setupScrollAnimations(){if("IntersectionObserver"in window){var e=document.querySelectorAll(".fade-in"),t=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),t.unobserve(e.target))}))}),{root:null,rootMargin:"0px",threshold:.1});e.forEach((function(e){t.observe(e)}))}else console.log("IntersectionObserver不被支持，跳过滚动动画")}function loadArticleDetails(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.open("GET","/data/articles/"+e+".json",!0),r.onload=function(){if(this.status>=200&&this.status<300)try{var e=JSON.parse(r.responseText);t(e)}catch(e){console.error("解析文章数据出错:",e),n(new Error("无法解析文章数据"))}else n(new Error("无法加载文章详情"))},r.onerror=function(){console.error("加载文章详情时出错"),n(new Error("网络请求失败"))},r.send()}))}function downloadFile(e,t){var n=document.createElement("a");n.href=e,n.download=t||"",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function initializeArticles(){var e=document.getElementById("articles-container");if(e){e.innerHTML="";for(var t=(currentPage-1)*ARTICLES_PER_PAGE,n=Math.min(t+ARTICLES_PER_PAGE,articles.length),r=t;r<n;r++){var a=createArticleElement(articles[r]);e.appendChild(a)}}}function createArticleElement(e){var t=document.createElement("div");return t.className="article-card glass-panel",t.innerHTML='<div class="article-image" style="background-image: url(\''+(e.image||"")+'\')"></div><div class="article-content"><h3>'+e.title+"</h3><p>"+(e.excerpt||"")+'</p><a href="'+(e.url||"#")+'" class="read-more">阅读更多 <i class="fas fa-arrow-right"></i></a></div>',t}function initializePagination(){var e=Math.ceil(articles.length/ARTICLES_PER_PAGE),t=document.getElementById("prev-page"),n=document.getElementById("next-page"),r=document.getElementById("page-indicator");r&&(r.textContent=currentPage+" / "+e),t&&(t.disabled=1===currentPage),n&&(n.disabled=currentPage===e),t&&(t.onclick=function(){currentPage>1&&(currentPage--,initializeArticles(),initializePagination())}),n&&(n.onclick=function(){currentPage<e&&(currentPage++,initializeArticles(),initializePagination())})}function initializeScrollEffects(){window.addEventListener("scroll",(function(){var e=window.scrollY,t=document.querySelector(".parallax");t&&(t.style.transform="translateY("+.5*e+"px)");for(var n=document.querySelectorAll(".fade-in"),r=0;r<n.length;r++){var a=n[r],i=a.getBoundingClientRect().top,c=a.getBoundingClientRect().bottom;i<window.innerHeight&&c>0&&a.classList.add("visible")}}))}async function fetchArticlesList(){const e=["hello-moonlight.md"],t=[];for(const n of e)try{const e=await fetch(`/articles/${n}`);if(!e.ok)continue;const r=(await e.text()).match(/^---([\s\S]*?)---/);let a={file:n};r&&r[1].trim().split("\n").forEach((e=>{const[t,...n]=e.split(":");a[t.trim()]=n.join(":").trim().replace(/^"|"$/g,"")})),t.push(a)}catch(e){continue}return t}async function renderArticlesList(){const e=document.getElementById("articles-container");if(!e)return;e.innerHTML="";const t=await fetchArticlesList();if(t.length)for(const n of t){const t=document.createElement("div");t.className="article-card glass-panel",t.innerHTML=`\n            <div class="article-image">\n                <img src="${n.cover||"/assets/images/default-cover.jpg"}" alt="${n.title||""}">\n            </div>\n            <div class="article-content">\n                <h3>${n.title||"未命名文章"}</h3>\n                <p>${n.excerpt||""}</p>\n                <div class="article-meta">\n                    <span>${n.date||""}</span>\n                </div>\n            </div>\n        `,t.addEventListener("click",(()=>{window.location.href=`article.html?file=${encodeURIComponent(n.file)}`})),e.appendChild(t)}else e.innerHTML="<div>暂无文章。</div>"}function getAllTags(){var e=new Set;return allArticles.forEach((t=>{Array.isArray(t.tags)&&t.tags.forEach((t=>e.add(t)))})),Array.from(e)}function renderTagFilter(){var e=document.getElementById("tag-filter");if(e){var t=getAllTags();if(0!==t.length){var n='<span class="tag-filter-label">标签筛选：</span>';n+=`<span class="tag tag-filter-item${null===currentTag?" active":""}" data-tag="">全部</span>`,t.forEach((e=>{n+=`<span class="tag tag-filter-item${currentTag===e?" active":""}" data-tag="${e}">${e}</span>`})),e.innerHTML=n,e.querySelectorAll(".tag-filter-item").forEach((e=>{e.onclick=function(){var e=this.getAttribute("data-tag");currentTag=e||null,currentPage=1,renderTagFilter(),renderArticles()}}))}else e.innerHTML=""}}function getQueryParam(e){return new URL(window.location.href).searchParams.get(e)}function initSearch(){const e=document.getElementById("search-input"),t=document.getElementById("search-btn");if(!e||!t)return;let n;e.addEventListener("input",(function(){clearTimeout(n),n=setTimeout((()=>{searchQuery=this.value.trim().toLowerCase(),currentPage=1,renderTagFilter(),renderArticles()}),300)})),t.addEventListener("click",(function(){searchQuery=e.value.trim().toLowerCase(),currentPage=1,renderTagFilter(),renderArticles()})),e.addEventListener("keypress",(function(e){"Enter"===e.key&&(searchQuery=this.value.trim().toLowerCase(),currentPage=1,renderTagFilter(),renderArticles())}))}function searchArticles(e,t){return t?e.filter((e=>{const n=(e.title||"").toLowerCase(),r=(e.excerpt||"").toLowerCase(),a=Array.isArray(e.tags)?e.tags.join(" ").toLowerCase():"",i=(e.author||"").toLowerCase();return n.includes(t)||r.includes(t)||a.includes(t)||i.includes(t)})):e}function highlightSearchResult(e,t){if(!t)return e;const n=new RegExp(`(${t})`,"gi");return e.replace(n,"<mark>$1</mark>")}document.addEventListener("DOMContentLoaded",(function(){document.getElementById("year")&&(document.getElementById("year").textContent=(new Date).getFullYear()),loadProfileInfo(),loadArticles(),initSearch(),setupScrollAnimations(),setupPagination()})),document.addEventListener("DOMContentLoaded",renderArticlesList);